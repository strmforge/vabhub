#!/usr/bin/env python3
"""
æµ‹è¯•TMDBæ’ä»¶åŠŸèƒ½
"""

import sys
import asyncio
from pathlib import Path

# æ·»åŠ æ’ä»¶è·¯å¾„åˆ°ç³»ç»Ÿè·¯å¾„
sys.path.insert(0, str(Path(__file__).parent / "VabHub-Plugins"))

try:
    from plugins.charts_tmdb_plugin import ChartsTMDBPlugin
    
    async def test_tmdb_plugin():
        """æµ‹è¯•TMDBæ’ä»¶"""
        print("ğŸ” å¼€å§‹æµ‹è¯•TMDBæ’ä»¶...")
        
        # åˆ›å»ºæ’ä»¶å®ä¾‹
        plugin = ChartsTMDBPlugin()
        
        # åˆå§‹åŒ–æ’ä»¶
        if not plugin.initialize():
            print("âŒ æ’ä»¶åˆå§‹åŒ–å¤±è´¥")
            return False
        
        print("âœ… æ’ä»¶åˆå§‹åŒ–æˆåŠŸ")
        
        # æµ‹è¯•è·å–çƒ­é—¨ç”µå½±
        try:
            print("ğŸ¬ æµ‹è¯•è·å–çƒ­é—¨ç”µå½±...")
            result = await plugin.get_movie_popular({"limit": 5})
            
            if result and "data" in result:
                movies = result["data"]
                print(f"âœ… æˆåŠŸè·å– {len(movies)} éƒ¨çƒ­é—¨ç”µå½±")
                for i, movie in enumerate(movies[:3], 1):
                    print(f"  {i}. {movie.get('title', 'æœªçŸ¥')} ({movie.get('year', 'æœªçŸ¥')})")
                return True
            else:
                print("âŒ è·å–çƒ­é—¨ç”µå½±å¤±è´¥")
                return False
                
        except Exception as e:
            print(f"âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: {e}")
            return False
    
    # è¿è¡Œæµ‹è¯•
    if __name__ == "__main__":
        result = asyncio.run(test_tmdb_plugin())
        if result:
            print("\nğŸ‰ TMDBæ’ä»¶æµ‹è¯•é€šè¿‡!")
        else:
            print("\nğŸ’¥ TMDBæ’ä»¶æµ‹è¯•å¤±è´¥!")
            sys.exit(1)
            
except ImportError as e:
    print(f"âŒ æ— æ³•å¯¼å…¥TMDBæ’ä»¶: {e}")
    print("è¯·ç¡®ä¿æ’ä»¶è·¯å¾„æ­£ç¡®ä¸”ä¾èµ–é¡¹å·²å®‰è£…")
    sys.exit(1)
except Exception as e:
    print(f"âŒ æµ‹è¯•è„šæœ¬å‡ºé”™: {e}")
    sys.exit(1)