#!/usr/bin/env python3
"""
测试TMDB插件功能
"""

import sys
import asyncio
from pathlib import Path

# 添加插件路径到系统路径
sys.path.insert(0, str(Path(__file__).parent / "VabHub-Plugins"))

try:
    from plugins.charts_tmdb_plugin import ChartsTMDBPlugin
    
    async def test_tmdb_plugin():
        """测试TMDB插件"""
        print("🔍 开始测试TMDB插件...")
        
        # 创建插件实例
        plugin = ChartsTMDBPlugin()
        
        # 初始化插件
        if not plugin.initialize():
            print("❌ 插件初始化失败")
            return False
        
        print("✅ 插件初始化成功")
        
        # 测试获取热门电影
        try:
            print("🎬 测试获取热门电影...")
            result = await plugin.get_movie_popular({"limit": 5})
            
            if result and "data" in result:
                movies = result["data"]
                print(f"✅ 成功获取 {len(movies)} 部热门电影")
                for i, movie in enumerate(movies[:3], 1):
                    print(f"  {i}. {movie.get('title', '未知')} ({movie.get('year', '未知')})")
                return True
            else:
                print("❌ 获取热门电影失败")
                return False
                
        except Exception as e:
            print(f"❌ 测试过程中出错: {e}")
            return False
    
    # 运行测试
    if __name__ == "__main__":
        result = asyncio.run(test_tmdb_plugin())
        if result:
            print("\n🎉 TMDB插件测试通过!")
        else:
            print("\n💥 TMDB插件测试失败!")
            sys.exit(1)
            
except ImportError as e:
    print(f"❌ 无法导入TMDB插件: {e}")
    print("请确保插件路径正确且依赖项已安装")
    sys.exit(1)
except Exception as e:
    print(f"❌ 测试脚本出错: {e}")
    sys.exit(1)