services:
  vabhub-core:
    image: ghcr.io/strmforge/vabhub-core:${VABHUB_CORE_VERSION}
    env_file: [.env]
    ports: ["8081:8081"]
    depends_on: [db, cache]

  vabhub-frontend:
    image: ghcr.io/strmforge/vabhub-frontend:${VABHUB_FE_VERSION}
    environment: [VITE_API_BASE=http://vabhub-core:8081]
    ports: ["8080:80"]
    depends_on: [vabhub-core]

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: vabhub
      POSTGRES_USER: vabhub
      POSTGRES_PASSWORD: change_me
    volumes: [db_data:/var/lib/postgresql/data]

  cache:
    image: redis:7-alpine

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    environment: [PUID=1000, PGID=1000, WEBUI_PORT=8080]
    ports: ["8080:8080", "6881:6881", "6881:6881/udp"]
    volumes: [qbt_config:/config, downloads:/downloads]

  emby:
    image: lscr.io/linuxserver/emby:latest
    environment: [PUID=1000, PGID=1000]
    ports: ["8096:8096"]
    volumes: [emby_config:/config, media:/media]

volumes:
  db_data:
  qbt_config:
  downloads:
  emby_config:
  media:
