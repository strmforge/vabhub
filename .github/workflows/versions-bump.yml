name: Bump Versions

on:
  workflow_dispatch:
    inputs:
      core_version:
        description: 'VabHub Core version (e.g., v1.2.3)'
        required: false
        type: string
      frontend_version:
        description: 'VabHub Frontend version (e.g., v1.2.3)'
        required: false
        type: string
      plugins_version:
        description: 'VabHub Plugins version (e.g., v1.2.3)'
        required: false
        type: string
      resources_version:
        description: 'VabHub Resources version (e.g., v1.2.3)'
        required: false
        type: string
      deploy_version:
        description: 'VabHub Deploy version (e.g., v1.2.3)'
        required: false
        type: string

jobs:
  bump:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update versions.json
        run: |
          if [ -n "${{ github.event.inputs.core_version }}" ]; then
            jq '.core = "${{ github.event.inputs.core_version }}"' versions.json > versions.tmp && mv versions.tmp versions.json
          fi
          
          if [ -n "${{ github.event.inputs.frontend_version }}" ]; then
            jq '.frontend = "${{ github.event.inputs.frontend_version }}"' versions.json > versions.tmp && mv versions.tmp versions.json
          fi
          
          if [ -n "${{ github.event.inputs.plugins_version }}" ]; then
            jq '.plugins = "${{ github.event.inputs.plugins_version }}"' versions.json > versions.tmp && mv versions.tmp versions.json
          fi
          
          if [ -n "${{ github.event.inputs.resources_version }}" ]; then
            jq '.resources = "${{ github.event.inputs.resources_version }}"' versions.json > versions.tmp && mv versions.tmp versions.json
          fi
          
          if [ -n "${{ github.event.inputs.deploy_version }}" ]; then
            jq '.deploy = "${{ github.event.inputs.deploy_version }}"' versions.json > versions.tmp && mv versions.tmp versions.json
          fi

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'Bump versions'
          title: 'Bump versions'
          body: |
            更新版本信息:
            - Core: ${{ github.event.inputs.core_version }}
            - Frontend: ${{ github.event.inputs.frontend_version }}
            - Plugins: ${{ github.event.inputs.plugins_version }}
            - Resources: ${{ github.event.inputs.resources_version }}
            - Deploy: ${{ github.event.inputs.deploy_version }}
          branch: bump-versions